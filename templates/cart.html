<!-- --- START OF MODIFICATIONS: templates/cart.html --- -->

{% extends "base.html" %}

{% block title %}Your Shopping Cart - AURA Apparel{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1>Your Shopping Cart</h1>
    </div>
</div>

<div class="container page-content cart-page-container">
    {% if cart_products %}
    <div class="cart-layout">
        <div class="cart-items">
            <table class="cart-table">
                <thead>
                    <tr>
                        <th class="col-product">Product</th>
                        <th class="col-price">Price</th>
                        <th class="col-quantity">Quantity</th> <!-- RESTORED: Quantity column -->
                        <th class="col-subtotal">Subtotal</th>
                        <th class="col-remove"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart_products %}
                    <tr>
                        <!-- NEW: A single cell for all product info -->
                        <td class="cart-item-info-cell">
                            <div class="product-cell">
                                <a href="{{ url_for('product_detail', product_id=item.id) }}">
                                    <img src="{{ url_for('static', filename='images/products/' + item.image_url) }}" alt="{{ item.name }}" class="cart-product-image">
                                </a>
                                <div class="cart-product-details">
                                    <a href="{{ url_for('product_detail', product_id=item.id) }}" class="cart-item-name-link">{{ item.name }}</a>
                                    <div class="price-cell">
                                        <span class="sale-price">₹{{ "%.0f"|format(item.sale_price) }}</span>
                                        {% if item.discount_percent > 0 %}
                                        <span class="original-price">₹{{ "%.0f"|format(item.original_price) }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </td>

                        <!-- NEW: A single cell for all actions -->
                        <td class="cart-item-actions-cell">
                            <!-- Remove Form -->
                            <form action="{{ url_for('remove_from_cart', cart_key=item.cart_key) }}" method="POST">
                                <button type="submit" class="btn-remove-mobile">Remove</button>
                            </form>
                            <!-- Update Form -->
                            <form action="{{ url_for('update_cart', cart_key=item.cart_key) }}" method="POST" class="update-form-mobile">
                                <select name="inventory_id" class="form-select form-select-sm">
                                    {% for inv in item.available_inventory %}
                                        <option value="{{ inv.id }}" {% if inv.id == item.inventory_id %}selected{% endif %} {% if inv.stock_quantity == 0 %}disabled{% endif %}>
                                            Size: {{ inv.size }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="10" class="form-control form-control-sm">
                                <button type="submit" class="btn btn-secondary btn-sm">Update</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="cart-summary">
            <h3>Cart Summary</h3>
            <!-- NEW: Detailed cost breakdown -->
            <div class="summary-row">
                <span>Total MRP</span>
                <span>₹{{ "%.0f"|format(total_mrp) }}</span>
            </div>
            <div class="summary-row discount">
                <span>Discount on MRP</span>
                <span>- ₹{{ "%.0f"|format(discount_on_mrp) }}</span>
            </div>
            <div class="summary-row">
                <span>Platform Fee</span>
                <span>₹{{ "%.0f"|format(platform_fee) }}</span>
            </div>
            <div class="summary-row">
                <span>Shipping Fee</span>
                {% if delivery_charge == 0 %}
                    <span class="free-shipping">FREE</span>
                {% else %}
                    <span>₹{{ "%.0f"|format(delivery_charge) }}</span>
                {% endif %}
            </div>
            <hr>
            <!-- MODIFIED: The final total row -->
            <div class="summary-row total">
                <strong>Total Amount</strong>
                <strong>₹{{ "%.0f"|format(final_total_price) }}</strong>
            </div>
            <a href="{{ url_for('checkout') }}" class="btn btn-primary btn-large">Proceed to Checkout</a>
        </div>
    </div>
    {% else %}
    <div class="cart-empty">
        <p>Your cart is currently empty.</p>
        <a href="{{ url_for('product_listing') }}" class="btn btn-primary">Continue Shopping</a>
    </div>
    {% endif %}
</div>
{% endblock %}

<!-- --- END OF MODIFICATIONS: templates/cart.html --- -->